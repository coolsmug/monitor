<%- include ("./include/header.ejs") %>

<%- include ("./include/_dash_board.ejs") %>

<div class="diverr">
    <h4><i class="fas fa-house-user"></i>Update Event</h4>
    <div class="direct">
      <a href="/admin/add_event/1" class="btn border-shadow"><i class="fas fa-plus"></i> Back to Add Events</a>
  </div>

    <div class="form_for_create">
        
        <%- include ('./partials/messages') %>

        <!-- Event Details Form -->
       <form id="eventForm" action="/admin/update-event/<%= event._id %>" method="POST">


            <div class="all-single-form">
                <div class="mb-3">
                    <div class="hop">
                        <label for="event_name">Event Name:</label>
                        <input type="text" name="event_name" value="<%= typeof event.event_name != 'undefined' ? event.event_name : '' %>" />
                    </div>
                    <div class="hop">
                        <label for="venue">Venue:</label>
                        <input type="text" name="venue" value="<%= typeof event.venue != 'undefined' ? event.venue : '' %>" />
                    </div>
                    <div class="hop">
                        <label for="start">Event Starts at:</label>
                        <input type="datetime-locatime" name="start" value="<%= typeof event.start != 'undefined' ? event.start : '' %>" placeholder="example 10:00 AM OR 1:00 PM" />
                    </div>
                     <div class="hop">
                        <label for="end">Event Ends at:</label>
                        <input type="datetime-locatime" name="end" value="<%= typeof event.end != 'undefined' ? event.end : '' %>" placeholder="example 10:00 AM OR 1:00 PM"/>
                    </div>
                    <div class="hop">
                        <label for="dates">Set Date and Time:</label>
                        <input type="datetime-local" name="dates" value="<%= typeof event.dates != 'undefined' ? event.dates : '' %>" />
                    </div>
                    <div class="hop">
                        <label for="event_status">Event status</label>
                        <select name="event_status" id="">
                          <option value="<%= event.event_status %>"><%= event.event_status %></option>
                          <option value="Inactive">Inactive</option>
                          <option value="Active">Active</option>
                          
                        </select>
                       
                    </div>
                     <div class="hop">
                        <label for="event_type">Event Type</label>
                         <select name="event_type" id="">
                          <option value="<%= event.event_type %>"><%= event.event_type %></option>
                          <option value="Upcoming">Upcoming</option>
                          <option value="Past">Past</option>
                          
                        </select>
                       
                    </div>
                    <div class="hop">
                        <label for="content">Content:</label>
                        <textarea name="content" id="content" placeholder="Enter your text here..."><%= event.content %></textarea>
                    </div>
                </div>
            </div>                                                

            <div class="mb-3">
                <input type="submit" value="Update Event">
            </div>
        </form>
    </div>

    <!-- Event Image Upload Form -->
    <div class="form_for_create">

      <form id="pageImageForm" action="/admin/upload-event-cover-image/<%= event._id %>" method="POST" enctype="multipart/form-data">

            <div class="form-group">
                <div class="hop">
                    <label for="img">Upload Event Image</label>
                    <input type="file" name="img" id="img">
                </div>
            </div>
            <div class="mb-3">
                <input type="submit" value="Upload Page Image">
            </div>
        </form>

    </div>

</div>

<footer class="foot">
    <h3>All rights reserved and Powered by Dark theme code <i class="fas fa-copyright"></i> 2024</h3>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const eventForm = document.getElementById('eventForm');

    if (eventForm) {
      eventForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Convert form fields into a plain JS object
        const formDataObj = Object.fromEntries(new FormData(e.target).entries());

        try {
          const response = await fetch(e.target.action, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formDataObj),
          });

          if (response.ok) {
            const result = await response.json();
            alert(result.message);
            window.location.href = result.redirectUrl;
          } else {
            const error = await response.json();
            alert('Error updating event: ' + error.error); // use .error since backend sends { error: ... }
          }
        } catch (err) {
          console.error('Error:', err);
          alert('An error occurred while updating the event.');
        }
      });
    }
  });
</script>

<%- include ("./include/footer.ejs") %>
