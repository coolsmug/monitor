<%- include ("./include/header.ejs") %> 

<%- include ("./include/_dash_board.ejs") %> 

   


<div class="diverr">
    <h3 style="position: absolute; top:0px; left: 10px;"><a href="<%= previousUrl %>">Back</a></h3>
    <h4>Use these forms to Update <%= staff.name %> </h4>
    <div class="form_for_create">
        <%- include ('./partials/messages') %>
        <form method="PUT" id="creat-Classing">
            <div class="all-single-form">
                <div class="mb-3">
                    <div class="hop">
                        <input type="hidden" name="id" value="<%= staff._id %> ">
                        <label for="roll">Roll Number:</label>
                        <input 
                        type="roll" 
                        name="roll" 
                        value="<%= staff.roll %>" />
                    </div>
                </div>
                <div class="mb-3">
                    <% let staffNo = '' %>
                  <% if(staff.admin_no) {%>
                    <% staffNo = staff.admin_no %>
                    <% }else { %>
                        <% staffNo = staffAdminNo %>
                        <% } %>
                    <div class="hop">
                        <label for="admin_no">Staff Admin No:</label>
                        <input 
                        type="name" 
                        name="admin_no" 
                        value="<%= staffNo %>" />
                    </div>
                  
                </div>
                <div class="mb-3">
                  
                    <div class="hop">
                        <label for="name">Name:</label>
                        <input 
                        type="name" 
                        name="name" 
                        value="<%= staff.name %>" />
                    </div>
                  
                </div>

                <div class="mb-3">
                  
                    <div class="hop">
                        <label for="award">Achievements/Awards:</label>
                        <textarea  name="award"  id=""><%= staff.award %></textarea>
                    </div>
                  
                </div>
                 <div class="mb-3">
                  
                    <div class="hop">
                        <label for="about">About:</label>
                      <textarea name="about" ><%= staff.about || '' %></textarea>
                    </div>
                  
                </div>
                
                <div class="mb-3">
                  
                    <div class="hop">
                        <label for="subject">Subject:</label>
                        <input 
                        type="subject" 
                        name="subject" 
                        value="<%= staff.subject %>" />
                    </div>
                  
                </div>
                 <div class="mb-3">
                  
                    <div class="hop">
                        <label for="position">Position:</label>
                        <input 
                        type="position" 
                        name="position" 
                        value="<%= staff.position %>" />
                    </div>
                  
                </div>
                <div class="mb-3">
                  
                    <div class="hop">
                        <label for="address">Address:</label>
                        <input 
                        type="address" 
                        name="address" 
                        value="<%= staff.address %>" />
                    </div>
                  
                </div>

                <div class="mb-3">
                  
                    <div class="hop">
                        <label for="mobile_phone">Mobile phone:</label>
                        <input 
                        type="mobile_phone" 
                        name="mobile_phone" 
                        value="<%= staff.mobile_phone %>" />
                    </div>
                  
                </div>
                <div class="mb-3">
                    <div class="hop">
                        <label for="gmail">Gmail:</label>
                        <input 
                        type="email" 
                        name="gmail" 
                        value="<%= staff.email %>" />
                    </div>
                </div>

                <div class="mb-3">
                    <div class="hop">
                        <label for="x">X (Twitter):</label>
                        <input 
                        type="text" 
                        name="x" 
                        value="<%= staff.x %>" />
                    </div>
                </div>

                <div class="mb-3">
                    <div class="hop">
                        <label for="instagram">Instagram:</label>
                        <input 
                        type="text" 
                        name="instagram" 
                        value="<%= staff.instagram %>" />
                    </div>
                </div>

                <div class="mb-3">
                    <div class="hop">
                        <label for="facebook">Facebook:</label>
                        <input 
                        type="text" 
                        name="facebook" 
                        value="<%= staff.facebook %>" />
                    </div>
                </div>

                <div class="mb-3">
                    <div class="hop">
                        <label for="linkedin">LinkedIn:</label>
                        <input 
                        type="text" 
                        name="linkedin" 
                        value="<%= staff.linkedin %>" />
                    </div>
                </div>

                    
            </div>
        
           
            <div class="mb-3">
                <input type="submit" value="Ok? Update">
            </div>
    
          
        </form>

        <form action="/admin/edit-staff-image/<%= staff._id %>" method="POST" enctype="multipart/form-data">
            <div class="form-group">
              <div class="hop">
                <label for="img">Image</label>
                <input type="file" name="img" id="image">
              </div>
            </div>
            <div class="mb-3">
              <input type="submit" value="Upload Image">
            </div>
        </form><br><br><br><br>


        <!-- // Face Embedding Capture Form -->
  <h2>Register Staff Face</h2>

<div style="text-align:center">
  <video id="video" width="320" height="240" autoplay playsinline></video>
  <canvas id="overlay" width="320" height="240"></canvas>
  <div>
    <button id="switchCameraBtn" type="button">Switch Camera</button>
    <button id="captureBtn" type="button">Capture Face</button>
  </div>

  <form action="/admin/register-staff-face/<%= staff._id %>" method="POST">
    <input type="hidden" name="embedding" id="embedding">
    <button id="saveBtn" type="submit">Save Face</button>
  </form>

  <pre id="result"></pre>
</div>

<style>
  #video, #overlay {
    position: relative;
    /* border: 2px solid #333; */
    border-radius: 10px;
  }
  #overlay {
    position: absolute;
    left: 0;
    top: 0;
  }
  button {
    margin: 10px 5px;
    padding: 8px 16px;
    font-size: 15px;
    cursor: pointer;
    border-radius: 6px;
  }
  #result {
    margin-top: 10px;
    font-family: monospace;
    white-space: pre-wrap;
    word-break: break-all;
  }
</style>

<footer class="foot">
  <h3>All rights reserved and Powered by Dark theme code <i class="fas fa-copyright"></i> 2024</h3>
</footer>

<%- include ("./include/footer.ejs") %> 

<!-- ‚úÖ Face API -->
<script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const video = document.getElementById("video");
  const overlay = document.getElementById("overlay");
  const captureBtn = document.getElementById("captureBtn");
  const saveBtn = document.getElementById("saveBtn");
  const switchCameraBtn = document.getElementById("switchCameraBtn");
  const embeddingInput = document.getElementById("embedding");
  const result = document.getElementById("result");

  const canvasCtx = overlay.getContext("2d");
  let usingBackCamera = true;
  let currentStream = null;

  // ‚úÖ Load FaceAPI models
  await Promise.all([
    faceapi.nets.tinyFaceDetector.loadFromUri("/models"),
    faceapi.nets.faceLandmark68Net.loadFromUri("/models"),
    faceapi.nets.faceRecognitionNet.loadFromUri("/models")
  ]);
  console.log("‚úÖ FaceAPI Models loaded");

  // üé• Start video stream
  async function startVideo() {
    try {
      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
      }

      const facingMode = usingBackCamera ? "environment" : "user";
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode } });
      currentStream = stream;
      video.srcObject = stream;
      console.log("üì∑ Using camera:", facingMode);
    } catch (err) {
      console.error("Camera error:", err);
      alert("‚ö†Ô∏è Please allow camera access.");
    }
  }

  await startVideo();

  // üîÑ Switch camera
  switchCameraBtn.addEventListener("click", async () => {
    usingBackCamera = !usingBackCamera;
    await startVideo();
  });

  // üß† Capture face embedding
  async function captureFaceEmbedding() {
    const detection = await faceapi
      .detectSingleFace(video, new faceapi.TinyFaceDetectorOptions())
      .withFaceLandmarks()
      .withFaceDescriptor();

    if (!detection) {
      alert("‚ö†Ô∏è No face detected. Please adjust and try again.");
      return;
    }

    // Draw detection box
    const dims = faceapi.matchDimensions(overlay, video, true);
    const resizedDet = faceapi.resizeResults(detection, dims);
    canvasCtx.clearRect(0, 0, overlay.width, overlay.height);
    faceapi.draw.drawDetections(overlay, resizedDet);

    // Save embedding
    embeddingInput.value = JSON.stringify(Array.from(detection.descriptor));
    result.textContent = "‚úÖ Face captured successfully!";
  }

  captureBtn.addEventListener("click", captureFaceEmbedding);
});
</script>


      
    </div>
    

</div>


     
<footer class="foot">
    <h3>All rights reserved and Powered by Dark theme code  <i class="fas fa-copyright"> </i> 2024</h3>
  </footer> 
<%- include ("./include/footer.ejs") %> 
