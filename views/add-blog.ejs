<%- include ("./include/header.ejs") %>

<%- include ("./include/_dash_board.ejs") %>

<div class="diverr">
    <h4><i class="fas fa-pen-nib"></i> Add Blog</h4>
    <div class="direct">
        <a href="/admin/get-all-blogs/1" class="btn border-shadow"><i class="fas fa-arrow-left"></i> Back to Blogs</a>
    </div>
    <div class="form_for_create">
        
        <%- include ('./partials/messages') %>
        
        <form id="eventForm" action="/admin/create-blog" method="POST">

            <div class="all-single-form">
                <div class="mb-3">
                    <div class="hop">
                        <label for="author">Author:</label>
                        <input type="text" name="author" value="<%= typeof author !== 'undefined' ? author : '' %>" required />
                    </div>
                    <div class="hop">
                        <label for="category">Category:</label>
                        <select id="category" name="category" required>
                        <option value="">-- Select Category --</option>
                        
                        <option value="politics">Politics</option>
                        <option value="business">Business & Economy</option>
                        <option value="technology">Technology</option>
                        <option value="health">Health</option>
                        <option value="education">Education</option>
                        <option value="sports">Sports</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="lifestyle">Lifestyle</option>
                        <option value="world">World News</option>
                        <option value="opinion">Opinion / Editorial</option>
                        <option value="religion">Religion News</option>
                        <option value="school_news">School News</option>
                        </select>
                    </div>
                    <div class="hop">
                        <label for="headline">Headline:</label>
                        <input type="text" name="headline" value="<%= typeof headline !== 'undefined' ? headline : '' %>" required />
                    </div>
                    <div class="hop">
                        <label for="content">Content:</label>
                        <textarea name="content" id="content" placeholder="Enter your blog content here..." required><%= typeof content !== 'undefined' ? content : '' %></textarea>
                    </div>
                    <div class="hop">
                        <label for="tags">Tags (separated by double spacing):</label>
                        <input type="text" name="tags" value="<%= typeof tags !== 'undefined' ? tags : '' %>" placeholder="e.g. education, school, teachers">
                    </div>
                    <div class="hop">
                        <label for="metaDescription">Meta Description (optional):</label>
                        <textarea name="metaDescription" placeholder="Short meta description (max 160 characters)"><%= typeof metaDescription !== 'undefined' ? metaDescription : '' %></textarea>
                    </div>
            
                </div>
            </div>                                                

            <div class="mb-3">
                <input type="submit" value="Publish Blog">
            </div>
        </form>
    </div> 
</div>

<footer class="foot">
    <h3>All rights reserved and Powered by Dark Theme Code <i class="fas fa-copyright"></i> 2024</h3>
</footer>   

<script>
document.getElementById('eventForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData.entries()); // convert FormData â†’ plain object

  try {
    const response = await fetch('/admin/create-blog', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });

    const result = await response.json();

    if (!response.ok) {
      alert('Error creating blog: ' + result.message);
      return;
    }

    window.location.href = result.redirectUrl;
  } catch (error) {
    console.error('Unexpected Error:', error);
    alert('An unexpected error occurred.');
  }
});


</script>

<%- include ("./include/footer.ejs") %>
